import dotenv from 'dotenv';
import path from 'path';

// Load environment variables FIRST before importing db
dotenv.config({ path: path.resolve(process.cwd(), '.env.local') });

import { db } from '../lib/db';
import { locations } from '../lib/schema';


// Helper to slugify if not available
function createSlug(text: string): string {
    return text
        .toString()
        .toLowerCase()
        .trim()
        .replace(/\s+/g, '-')     // Replace spaces with -
        .replace(/[^\w\-]+/g, '') // Remove all non-word chars
        .replace(/\-\-+/g, '-')   // Replace multiple - with single -
        .replace(/^-+/, '')       // Trim - from start of text
        .replace(/-+$/, '');      // Trim - from end of text
}

const rawLocations = [
    { name: "Ammanur", pincode: "631002" },
    { name: "Anaipakkam", pincode: "631003" },
    { name: "Andiappanur", pincode: "631151" },
    { name: "Attupakkam", pincode: "631051" },
    { name: "Ganapathipuram", pincode: "631051" },
    { name: "Guruvarajpet", pincode: "631101" },
    { name: "Iluppaithandalam", pincode: "631151" },
    { name: "Ins Rajali", pincode: "631006" },
    { name: "Jagirthandalam", pincode: "631052" },
    { name: "Jambukulam", pincode: "631102" },
    { name: "Jayapuram", pincode: "631102" },
    { name: "Jothinagar", pincode: "631003" },
    { name: "Kainoor", pincode: "631003" },
    { name: "Kakkolam", pincode: "631151" },
    { name: "Kalanur", pincode: "631004" },
    { name: "Kalathur", pincode: "631004" }, // Retained as Kalathur per note
    { name: "Kavanur", pincode: "631004" },
    { name: "Kaveripakkam", pincode: "631051" },
    { name: "Karikkal", pincode: "631102" },
    { name: "Kathari", pincode: "631151" },
    { name: "Kodakkal", pincode: "631102" },
    { name: "Kondapalayam", pincode: "631102" },
    { name: "Krishnapuram", pincode: "631002" },
    { name: "Melapulam", pincode: "631052" },
    { name: "Melarasambattu", pincode: "631003" },
    { name: "Mittapettai", pincode: "631101" },
    { name: "Mosur", pincode: "631004" },
    { name: "Mudur", pincode: "631003" },
    { name: "Nandiveduthangal", pincode: "631101" },
    { name: "Nagavedu", pincode: "631002" },
    { name: "Namali", pincode: "631051" },
    { name: "Pandianallore", pincode: "631102" },
    { name: "Parithiputhur", pincode: "631002" },
    { name: "Peruvalayam", pincode: "631052" },
    { name: "Pillaipakkam", pincode: "631052" },
    { name: "Sayanavaram", pincode: "631051" },
    { name: "Sendamangalam", pincode: "631051" },
    { name: "Seyyoor", pincode: "631004" },
    { name: "Sholingur", pincode: "631102" },
    { name: "Sholingur Bazaar", pincode: "631102" },
    { name: "Sirunamalli", pincode: "631002" },
    { name: "Somasamudram", pincode: "631102" },
    { name: "Tirumalpur", pincode: "631051" },
    { name: "Ulianallore", pincode: "631052" },
    { name: "Uriyur", pincode: "631151" },
    { name: "Vangupattu", pincode: "631102" },
    { name: "Winterpet", pincode: "631005" },
    { name: "Kasba", pincode: "632001" },
    { name: "Krishnanagar", pincode: "632001" },
    { name: "Old District Board Buildings", pincode: "632001" },
    { name: "Old Town", pincode: "632001" },
    { name: "R N Palayam", pincode: "632001" },
    { name: "Sainathapuram", pincode: "632001" },
    { name: "Sankaranpalayam", pincode: "632001" },
    { name: "Sullivanpet", pincode: "632001" },
    { name: "Vellore Cantonment", pincode: "632001" },
    { name: "Vellore Collectorate", pincode: "632001" },
    { name: "Vellore Fort", pincode: "632001" },
    { name: "Vellore", pincode: "632001" },
    { name: "Vellore South", pincode: "632001" },
    { name: "Voorhees College", pincode: "632001" },
    { name: "Bakiyath", pincode: "632004" },
    { name: "CMC Hospital", pincode: "632004" },
    { name: "Gandhi Road", pincode: "632004" },
    { name: "Vellore Bazaar", pincode: "632004" },
    { name: "Vellore Market", pincode: "632004" },
    { name: "Vellore H.O", pincode: "632004" },
    { name: "Baghayam", pincode: "632002" },
    { name: "CMC", pincode: "632002" },
    { name: "Chitteri", pincode: "632002" },
    { name: "Edayansathu", pincode: "632002" },
    { name: "Palamathi", pincode: "632002" },
    { name: "Saduperi", pincode: "632002" },
    { name: "Virupakshipuram", pincode: "632002" },
    { name: "Ampuram", pincode: "632009" },
    { name: "Bye Pass Road", pincode: "632009" },
    { name: "Rangapuram", pincode: "632009" },
    { name: "Sathuvachari", pincode: "632009" },
    { name: "Sathuvachari Extension", pincode: "632009" },
    { name: "Abdullapuram", pincode: "632010" },
    { name: "Melmonavur", pincode: "632010" },
    { name: "Kattupadi", pincode: "632011" },
    { name: "Thuthipattu", pincode: "632011" },
    { name: "Kaniyambadi", pincode: "632102" },
    { name: "Amirthi", pincode: "632102" },
    { name: "Eriyur", pincode: "632103" },
    { name: "Melkuppachinna", pincode: "632102" },
    { name: "Nammiyambattu", pincode: "632102" },
    { name: "Nadanur", pincode: "632102" },
    { name: "Nagalur", pincode: "632102" },
    { name: "Unai", pincode: "632101" },
    { name: "Eripudhur", pincode: "632101" },
    { name: "Appukal", pincode: "632101" },
    { name: "Ganganallur", pincode: "632101" },
    { name: "Ongapadi", pincode: "632101" },
    { name: "Varadalambattu", pincode: "632101" },
    { name: "Agaram", pincode: "632104" },
    { name: "Erayangadu", pincode: "632104" },
    { name: "Karigiri", pincode: "632106" },
    { name: "Kandhipedu", pincode: "632106" },
    { name: "Arumparuthi", pincode: "632106" },
    { name: "Sevur", pincode: "632106" },
    { name: "Serkadu", pincode: "632106" },
    { name: "Budur", pincode: "632105" },
    { name: "Elavambadi", pincode: "632105" },
    { name: "Govindareddipalayam", pincode: "632105" },
    { name: "Pulimedu", pincode: "632105" },
    { name: "Sekkanur", pincode: "632105" },
    { name: "Sivananthapuram", pincode: "632105" },
    { name: "Tirumalpuram", pincode: "632105" },
    { name: "Anaikkattu", pincode: "632101" },
    { name: "Poigai", pincode: "632114" },
    { name: "Poigai Mottur", pincode: "632114" },
    { name: "Thiruvalluvar University", pincode: "632115" },
    { name: "Ayal", pincode: "632505" },
    { name: "Banavaram", pincode: "632505" },
    { name: "Govindacherrykuppam", pincode: "632505" },
    { name: "Kammarajapuram", pincode: "632505" },
    { name: "Kavasampattu", pincode: "632204" },
    { name: "Surai", pincode: "632505" },
    { name: "Rottukadai", pincode: "632508" },
    { name: "Alapakkam", pincode: "632508" },
    { name: "Kattupakkam", pincode: "632502" },
    { name: "Asamandur", pincode: "632502" },
    { name: "Manamadurai", pincode: "632502" },
    { name: "Melkalathur", pincode: "632502" },
    { name: "Mahendravadi", pincode: "632502" },
    { name: "Asiriyar Nagar", pincode: "632509" },
    { name: "Arungundram", pincode: "632509" },
    { name: "Ayilam", pincode: "632509" },
    { name: "Melvisharam", pincode: "632509" },
    { name: "Ammoor", pincode: "632501" },
    { name: "Kalmelkuppam", pincode: "632501" },
    { name: "Marimanikuppam", pincode: "632501" },
    { name: "Palayamangadu", pincode: "632503" },
    { name: "Arcot", pincode: "632503" },
    { name: "Thoppukhana", pincode: "632503" },
    { name: "Ladavaram", pincode: "632503" },
    { name: "Pudupadi", pincode: "632503" },
    { name: "Melmankuppam", pincode: "632203" },
    { name: "Melmayil", pincode: "632203" },
    { name: "Senji", pincode: "632202" },
    { name: "Kalambattu", pincode: "632202" },
    { name: "Panamadangi", pincode: "632202" },
    { name: "Annangudi", pincode: "632202" },
    { name: "Arumbakkam", pincode: "632202" },
    { name: "Angarankuppam", pincode: "632204" },
    { name: "Muttukur", pincode: "632204" },
    { name: "Mudinampattu", pincode: "632204" },
    { name: "Vaduganthangal", pincode: "632204" },
    { name: "Chennasamudram", pincode: "632506" },
    { name: "Kaniyanur", pincode: "632506" },
    { name: "Karikkanthangal", pincode: "632506" },
    { name: "Mazharyur", pincode: "632506" },
    { name: "Mecheri", pincode: "632506" },
    { name: "Melnathambakkam", pincode: "632506" },
    { name: "Velurâ€“Kalavai", pincode: "632506" },
    { name: "Kalavai", pincode: "632506" },
    { name: "Arapakkam", pincode: "632517" },
    { name: "Kilminnal", pincode: "632517" },
    { name: "Melakuppam", pincode: "632517" },
    { name: "Nandiyalam", pincode: "632517" },
    { name: "Puttuthakku", pincode: "632517" },
    { name: "Ratnagiri Kilminnal", pincode: "632517" },
    { name: "Eriyur Amirthi", pincode: "632102" },
    { name: "Murukkampattu", pincode: "632203" },
    { name: "Chinnapalampakkam", pincode: "632113" },
    { name: "Jordhankollai", pincode: "632113" },
    { name: "Naganadhi", pincode: "632113" },
    { name: "Sathupalayam", pincode: "632113" },
    { name: "Tellai", pincode: "632113" },
    { name: "Thuthikkadu", pincode: "632113" },
    { name: "Veppampattu", pincode: "632113" },
    { name: "Brahmapuram", pincode: "632014" },
    { name: "VIT Campus", pincode: "632014" },
    { name: "Eranthangal", pincode: "632519" },
    { name: "Karnambut", pincode: "632519" },
    { name: "Sembarayanallur", pincode: "632519" },
    { name: "Vellore Sugar Mills", pincode: "632519" },
    { name: "Ammundi", pincode: "632519" },
    { name: "Ayarpadi", pincode: "632531" },
    { name: "Durgam", pincode: "632512" },
    { name: "Gudalur", pincode: "632510" },
    { name: "Paranji", pincode: "632510" },
    { name: "Paravathur", pincode: "632510" },
    { name: "Kunnathur", pincode: "632510" },
    { name: "Minnal", pincode: "632510" },
    { name: "Punganur", pincode: "632507" },
    { name: "Sambasivapuram", pincode: "632507" },
    { name: "Varagur", pincode: "632507" },
    { name: "Anaimallur", pincode: "632507" },
    { name: "Thalangai", pincode: "632501" },
    { name: "Marudhalam", pincode: "632501" },
    { name: "Neelakandarayanpattai", pincode: "632501" },
    { name: "Ozhughur", pincode: "632501" },
    { name: "Seri", pincode: "632508" },
    { name: "Pagaveli", pincode: "632508" },
    { name: "Panaiyur", pincode: "632518" },
    { name: "Pennagar", pincode: "632518" },
    { name: "Vembi", pincode: "632518" },
    { name: "Jagirvalavanur", pincode: "632511" },
    { name: "Esayanur", pincode: "632511" },
    { name: "Palayanur", pincode: "632512" },
    { name: "Timiri", pincode: "632512" },
    { name: "Nambarai", pincode: "632512" },
    { name: "Devarishikuppam", pincode: "632209" },
    { name: "Machanur", pincode: "632209" },
    { name: "Nagalakuppam", pincode: "632209" },
    { name: "Rusa Campus", pincode: "632209" },
    { name: "Melkavanur", pincode: "632209" },
    { name: "Katrambakkam", pincode: "632501" },
    { name: "Periasengadu", pincode: "632501" },
    { name: "Kadaperi", pincode: "632508" },
    { name: "Chinnasamudram", pincode: "632506" },
    { name: "Pulivalam", pincode: "632505" },
    { name: "Vettuvanam", pincode: "635809" },
    { name: "Gudiyattam", pincode: "632602" },
    { name: "Bhuvaneswaripet", pincode: "632602" },
    { name: "Puttavaripalli", pincode: "632603" },
    { name: "Varadareddipalli", pincode: "632603" },
    { name: "Viludonpalayam", pincode: "632603" },
    { name: "Paradarami", pincode: "632603" },
    { name: "Odugathur", pincode: "632103" },
    { name: "Kottamitta", pincode: "632601" },
    { name: "Mordhana", pincode: "632601" },
    { name: "Modikuppam", pincode: "632601" },
    { name: "Sempalli", pincode: "632601" },
    { name: "Thattaparai", pincode: "632601" },
    { name: "Thattimanapalli", pincode: "632601" },
    { name: "Erathangal", pincode: "632601" },
    { name: "Latteri", pincode: "632202" },
    { name: "Thongumalai", pincode: "632103" },
    { name: "Peenjamandai", pincode: "632103" },
    { name: "Ocheri", pincode: "632531" },
    { name: "Perumbulipakkam", pincode: "632531" },
    { name: "Kalathur", pincode: "632531" },
    { name: "Perumapattu", pincode: "635702" },
    { name: "Gandhipet", pincode: "635601" },
    { name: "Tirupattur", pincode: "635601" },
    { name: "Tirupattur TNHB", pincode: "635601" },
    { name: "Tirupattur Fort", pincode: "635602" },
    { name: "Pudukottai", pincode: "635602" },
    { name: "Christukula Ashram", pincode: "635602" },
    { name: "Kadirimangalam", pincode: "635602" },
    { name: "Karuppanur", pincode: "635602" },
    { name: "Kothakottai", pincode: "635752" },
    { name: "Kondayanchi", pincode: "635801" },
    { name: "Eachangal", pincode: "635801" },
    { name: "Ramanaickenpettai", pincode: "635801" },
    { name: "Chikkanankuppam", pincode: "635801" },
    { name: "Thekkupattu", pincode: "635801" },
    { name: "Athipet", pincode: "635703" },
    { name: "Peddur", pincode: "635701" },
    { name: "Naickanur", pincode: "635701" },
    { name: "Narasingapuram", pincode: "635701" },
    { name: "Vasanthapuram", pincode: "635701" },
    { name: "Kavalur", pincode: "635701" },
    { name: "Jolarpettai", pincode: "635851" },
    { name: "Somanaickenpatti", pincode: "635851" },
    { name: "Pullaneri", pincode: "635851" },
    { name: "Tiriyalam", pincode: "635851" },
    { name: "Vaniyambadi", pincode: "635751" },
    { name: "Pudur Vaniyambadi", pincode: "635751" },
    { name: "Valayambattu", pincode: "635751" },
    { name: "Periyapet", pincode: "635751" },
    { name: "Perumalpet", pincode: "635751" },
    { name: "Govindapuram", pincode: "635751" },
    { name: "Devasthanam", pincode: "635751" },
    { name: "Khaderpet", pincode: "635751" },
    { name: "Chettiappanur", pincode: "635751" },
    { name: "Kandili", pincode: "635901" },
    { name: "Chinnakandili", pincode: "635901" },
    { name: "East Badanavadi", pincode: "635901" },
    { name: "Mandalanayanagunda", pincode: "635901" },
    { name: "Periagaram", pincode: "635901" },
    { name: "Sevathur", pincode: "635654" },
    { name: "Lakkinaickenpatti", pincode: "635654" },
    { name: "Natham", pincode: "635654" },
    { name: "Periyakannalapatti", pincode: "635654" },
    { name: "Rengapalayam", pincode: "635653" },
    { name: "Matrapalli", pincode: "635652" },
    { name: "Kurumberi", pincode: "635652" },
    { name: "Nayakkanur", pincode: "635652" },
    { name: "Perambattu", pincode: "635652" },
    { name: "Simnapudur", pincode: "635652" },
    { name: "Kurumbakeri", pincode: "635653" },
    { name: "Rajapalayam", pincode: "635653" },
    { name: "Rachamangalam", pincode: "635653" },
    { name: "Vengalapuram", pincode: "635653" },
    { name: "Kethandapatti", pincode: "635815" },
    { name: "Kethandapatti Sugar Mills", pincode: "635815" },
    { name: "Sathambakkam", pincode: "635808" },
    { name: "Vadakkapalayam", pincode: "635808" },
    { name: "Nariyambattu", pincode: "635808" },
    { name: "Masigam", pincode: "635810" },
    { name: "Erikutti", pincode: "635810" },
    { name: "Kokkalur", pincode: "635810" },
    { name: "Pernambut", pincode: "635810" },
    { name: "Morasapalli", pincode: "635810" },
    { name: "Karungal", pincode: "635804" },
    { name: "Thollapalli", pincode: "635804" },
    { name: "Valayalkarapatti", pincode: "635804" },
    { name: "Madanur", pincode: "635804" },
    { name: "Nanjangondapuram", pincode: "635804" },
    { name: "Jagapuram", pincode: "635651" },
    { name: "Paniyandapalli", pincode: "635651" },
    { name: "Parandapalli", pincode: "635651" },
    { name: "Jayapuram", pincode: "635651" },
    { name: "Puthagaram", pincode: "635651" },
    { name: "Achamangalam", pincode: "635651" },
    { name: "Mallagunta", pincode: "635852" },
    { name: "Jangalapuram", pincode: "635852" },
    { name: "Athiperumanur", pincode: "635852" },
    { name: "Nayanacheruvu", pincode: "635852" },
    { name: "Vettapattu", pincode: "635852" },
    { name: "Udayendiram", pincode: "635754" },
    { name: "Ilayanagaram", pincode: "635754" },
    { name: "Vadacheri", pincode: "635754" },
    { name: "Thumberi", pincode: "635754" },
    { name: "Nimmiyambattu", pincode: "635752" },
    { name: "Vallipattu", pincode: "635752" },
    { name: "Chinnapallikuppam", pincode: "635754" },
    { name: "Chinnathottalam", pincode: "635813" },
    { name: "Kadhavalam", pincode: "635811" },
    { name: "Venkatasamudram", pincode: "635811" },
    { name: "Thimmanamuthur", pincode: "635653" },
    { name: "Chinnavarikam", pincode: "635811" },
    { name: "Chinnakarumbur", pincode: "635811" },
    { name: "Pallavalli", pincode: "635701" },
    { name: "Kodayanchi", pincode: "635801" },
    { name: "Yelagiri Hills", pincode: "635853" },
    { name: "Nilavur", pincode: "635853" },
    { name: "Mangalam", pincode: "635853" },
    { name: "Velanai", pincode: "635854" },
    { name: "Sorakayalnatham", pincode: "635854" },
    { name: "Pachur", pincode: "635854" },
    { name: "Kodur", pincode: "635854" },
    { name: "Kothur", pincode: "635854" },
    { name: "Madanancherry", pincode: "635754" },
    { name: "Somepalli", pincode: "635802" },
    { name: "Somalapuram", pincode: "635802" },
    { name: "Gangapuram", pincode: "635802" },
    { name: "Naickaneri", pincode: "635802" },
    { name: "Ambur", pincode: "635802" },
    { name: "Ambur Bazaar", pincode: "635802" },
    { name: "Erukkambattu", pincode: "635810" },
    { name: "Aravatla", pincode: "635810" },
    { name: "Kambugudi", pincode: "635655" },
    { name: "Perumpalli", pincode: "635655" },
    { name: "Nellipattu", pincode: "635655" },
    { name: "Nadukuppam", pincode: "635655" },
    { name: "Kilur", pincode: "635655" },
    { name: "Kombai", pincode: "635655" },
    { name: "Chinnavattanur", pincode: "635655" },
    { name: "Thagarakuppam", pincode: "635655" }
];

async function seedLocations() {
    console.log(`Starting seed of ${rawLocations.length} locations...`);

    let inserted = 0;
    let skipped = 0;

    for (const loc of rawLocations) {
        try {
            const slug = createSlug(loc.name);

            // Check if exists
            // Note: In a real script we'd check DB, but for simplicity we'll use ON CONFLICT DO NOTHING if possible,
            // or just try insert and catch error if unique constraint fails.
            // Since we don't have easy access to 'eq' here without importing everything, let's just try insert.

            await db.insert(locations).values({
                name: loc.name,
                slug: slug,
                pincode: loc.pincode,
                city: 'Vellore',
                state: 'Tamil Nadu'
            }).onConflictDoNothing();

            inserted++;
        } catch (error) {
            console.error(`Error inserting ${loc.name}:`, error);
            skipped++;
        }
    }

    console.log(`Seeding complete. Inserted/Checked: ${inserted}, Skipped/Error: ${skipped}`);
    process.exit(0);
}

seedLocations().catch(err => {
    console.error('Seeding failed:', err);
    process.exit(1);
});
